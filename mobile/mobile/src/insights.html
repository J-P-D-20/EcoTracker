<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insights Page</title>
    <link rel="stylesheet" href="css/insights.css">
</head>
<body>

<div class="insights-page">

    <!-- Header -->
    <div class="header">
        <a class="back-btn" href="home.html">
            <img src="assets/icon/back-arrow.png" alt="Back">
        </a>
        <h2>Insights</h2>
    </div>

    <!-- Subtitle -->
    <p class="subtitle">Your total carbon summary.</p>

    <!-- Section Title -->
    <h3 class="section-title">Carbon Footprint</h3>

    <!-- Stats Grid -->
    <div class="stats-grid">

        <div class="stat-card">
            <h4>Overall Carbon Footprint</h4>
            <p id="total" class="value"></p>
        </div>

        <div class="stat-card">
            <h4>Avg. Carbon Footprint</h4>
            <p  id="average" class="value"></p>
        </div>

        <div class="stat-card date-stat">
            <h4>Lowest Emission Date</h4>
            <div class="value-line">
                <span id="min-date" class="date"></span>
                <span id="min-carbon" class="emission"></span>
            </div>
        </div>

        <div class="stat-card date-stat">
            <h4>Highest Emission Date</h4>
            <div class="value-line">
                <span  id="max-date" class="date"></span>
                <span id="max-carbon" class="emission"></span>
            </div>
        </div>

    </div>

    <!-- Nav Bar -->
    <div class="navbar">
        <a class="nav-icon" href="home.html">
            <img src="assets/icon/home.png" class="nav-icon-img" alt="Home Icon">
        </a>

        <a class="nav-icon" href="insights.html">
            <img src="assets/icon/chart.png" class="nav-icon-img" alt="Chart Icon">
        </a>

        <a class="nav-icon" href="profile.html">
            <img src="assets/icon/user.png" class="nav-icon-img" alt="User Icon">
        </a>
    </div>

</div>

</body>

<script>
    //average co2 fetch
    fetch("http://localhost:3000/co2/average",{
        method : "GET",
        headers: {
            "Content-Type" : "application/json",
            authorization : `Bearer ${localStorage.getItem("token")}`
        }
    })
    .then(response => response.json())
    .then(data =>{
            document.getElementById("average").textContent = data.average + "kg CO₂";
    }).catch(error => {
        console.error("Error fetching average CO2 data:", error);
    });

    //total co2 fetch
    fetch("http://localhost:3000/co2/total",{
        method : "GET",
        headers: {
            "Content-Type" : "application/json",
            authorization : `Bearer ${localStorage.getItem("token")}`
        }
    })
    .then(response => response.json())
    .then(data =>{
            document.getElementById("total").textContent = data.total + "kg CO₂";
    }).catch(error => {
        console.error("Error fetching total CO2 data:", error);
    });

    //fetch min co2
    fetch("http://localhost:3000/co2/footprints/min", {
        method: "GET",
        headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${localStorage.getItem("token")}`,
        },
    })
    .then((response) => response.json())
    .then((data) => {
        document.getElementById("min-date").textContent = data.min.created_at;
        document.getElementById("min-carbon").textContent = data.min.result + " kg CO₂";
    }).catch((error) => {
        console.error("Error fetching minimum CO2 data:", error);
    });


    //fetch max co2
    fetch("http://localhost:3000/co2/footprints/max", {
        method: "GET",
        headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${localStorage.getItem("token")}`,
        },
    })
    .then((response) => response.json())
    .then((data) => {
        document.getElementById("max-date").textContent = data.max.created_at;
        document.getElementById("max-carbon").textContent = data.max.result + "kg CO₂";
    }).catch((error) => {   
        console.error("Error fetching maximum CO2 data:", error);
    });
</script>
</html>
